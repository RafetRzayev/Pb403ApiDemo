<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    <h1>Hello</h1>
    <input type="text" name="username" id="usernameInput" placeholder="username" />
    <input type="password" name="password" id="passwordInput" placeholder="password" />
    <button onclick="login()">Login</button>

    <button onclick="loadData()">Load data</button>
    <table>
        <thead>
            <tr>
                <th>Id</th>
                <th>Name</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</body>
</html>

<script>

    function login() {
        const username = document.getElementById('usernameInput').value;
        const password = document.getElementById('passwordInput').value;
        fetch('http://gadimovsabir-001-site9.mtempurl.com/api/auth/login',
            {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ username, password })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Login successful:', data);
                localStorage.setItem('token', data.token);
            })
            .catch(error => console.error('Error during login:', error));
    }


    function loadData() {
        const table = document.querySelector('tbody');
        const token = localStorage.getItem('token');    
        fetch('http://gadimovsabir-001-site9.mtempurl.com/api/Products',
            {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`,
                }
            })
            .then(response => response.json())
            .then(data => {
                table.innerHTML = '';

                console.log(data);
                for (let student of data) {
                    table.innerHTML += `
                <tr>
                    <td>${student.id}</td>
                    <td>${student.name}</td>
                </tr>
            `;
                }
            })
            .catch(error => console.error('Error fetching data:', error));
    }
</script>